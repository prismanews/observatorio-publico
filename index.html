<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Observatorio Anticorrupci√≥n</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="estilo.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .grafico-container {
            height: 200px;
            margin: 20px 0;
        }
        .leyenda-mapa {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            font-size: 0.8rem;
            margin: 10px 0;
        }
        .color-box {
            width: 15px;
            height: 15px;
            border-radius: 3px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="pull-indicator" id="pullIndicator">‚ü≥ Actualizar</div>
    
    <div class="container">
        <header class="obs-header">
            <h1>üïµÔ∏è Observatorio Anticorrupci√≥n</h1>
            <p>52 municipios ¬∑ 14 alertas ¬∑ 2,671,219,661‚Ç¨</p>
            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                <span class="badge">19/02/2026 12:43</span>
                <a href="datos/informe_transparencia.pdf" class="btn">üì• PDF</a>
                <button class="btn btn-outline" id="refreshBtn">üîÑ</button>
            </div>
        </header>

        <div class="tabs">
            <div class="tab active" onclick="showTab('mapa')">üó∫Ô∏è Mapa</div>
            <div class="tab" onclick="showTab('alertas')">üö® Alertas</div>
            <div class="tab" onclick="showTab('promesas')">üìä Promesas</div>
            <div class="tab" onclick="showTab('redes')">üï∏Ô∏è Redes</div>
        </div>

        <div id="mapa" class="tab-content">
            <div class="obs-card">
                <h2>üó∫Ô∏è Riesgo por Municipio</h2>
                <div id="map" style="height: 400px;"></div>
                <div class="leyenda-mapa">
                    <span><span class="color-box" style="background:#10b981;"></span> Bajo</span>
                    <span><span class="color-box" style="background:#eab308;"></span> Medio</span>
                    <span><span class="color-box" style="background:#f59e0b;"></span> Alto</span>
                    <span><span class="color-box" style="background:#ef4444;"></span> Muy alto</span>
                    <span>‚ö†Ô∏è Alerta activa</span>
                </div>
            </div>
        </div>

        <div id="alertas" class="tab-content" style="display:none;">
            <div class="obs-card">
                <h2>üö® Alertas Cr√≠ticas</h2>
                <div class="alertas-container">
                    
                    <a href="https://www.boe.es/diario_boe/txt.php?id=BOE-2023-1148" target="_blank" class="alerta-link">
                        <div class="alerta-item critica">
                            <span class="alerta-tipo">üî¥ CR√çTICA</span>
                            <div class="alerta-msg">SUBVENCI√ìN EXTREMA: Ayuntamiento de C√≥rdoba</div>
                            <div class="alerta-motivo">Importe de 77.574.602‚Ç¨ - 481% sobre la media</div>
                            <small>C√≥rdoba ¬∑ Impacto MUY ALTO</small>
                        </div>
                    </a>
                    
                    <a href="https://www.boe.es/diario_boe/txt.php?id=BOE-2023-3889" target="_blank" class="alerta-link">
                        <div class="alerta-item critica">
                            <span class="alerta-tipo">üî¥ CR√çTICA</span>
                            <div class="alerta-msg">SUBVENCI√ìN EXTREMA: Ayuntamiento de Melilla</div>
                            <div class="alerta-motivo">Importe de 75.654.450‚Ç¨ - 466% sobre la media</div>
                            <small>Melilla ¬∑ Impacto MUY ALTO</small>
                        </div>
                    </a>
                    
                    <a href="https://www.boe.es/diario_boe/txt.php?id=BOE-2025-6875" target="_blank" class="alerta-link">
                        <div class="alerta-item critica">
                            <span class="alerta-tipo">üî¥ CR√çTICA</span>
                            <div class="alerta-msg">SUBVENCI√ìN EXTREMA: Ayuntamiento de Las Palmas</div>
                            <div class="alerta-motivo">Importe de 74.680.939‚Ç¨ - 459% sobre la media</div>
                            <small>Las Palmas ¬∑ Impacto MUY ALTO</small>
                        </div>
                    </a>
                    
                    <a href="https://www.boe.es/diario_boe/txt.php?id=BOE-2025-1718" target="_blank" class="alerta-link">
                        <div class="alerta-item critica">
                            <span class="alerta-tipo">üî¥ CR√çTICA</span>
                            <div class="alerta-msg">SUBVENCI√ìN EXTREMA: Ayuntamiento de La Rioja</div>
                            <div class="alerta-motivo">Importe de 73.681.906‚Ç¨ - 452% sobre la media</div>
                            <small>La Rioja ¬∑ Impacto MUY ALTO</small>
                        </div>
                    </a>
                    
                    <a href="https://www.boe.es/diario_boe/txt.php?id=BOE-2024-6770" target="_blank" class="alerta-link">
                        <div class="alerta-item critica">
                            <span class="alerta-tipo">üî¥ CR√çTICA</span>
                            <div class="alerta-msg">SUBVENCI√ìN EXTREMA: Sistemas Inform√°ticos...</div>
                            <div class="alerta-motivo">Importe de 67.624.517‚Ç¨ - 406% sobre la media</div>
                            <small>Palencia ¬∑ Impacto MUY ALTO</small>
                        </div>
                    </a>
                    
                    <a href="https://www.boe.es/diario_boe/txt.php?id=BOE-2026-1190" target="_blank" class="alerta-link">
                        <div class="alerta-item critica">
                            <span class="alerta-tipo">üî¥ CR√çTICA</span>
                            <div class="alerta-msg">SUBVENCI√ìN EXTREMA: Tecnolog√≠as del Futuro SL</div>
                            <div class="alerta-motivo">Importe de 63.772.027‚Ç¨ - 377% sobre la media</div>
                            <small>Barcelona ¬∑ Impacto MUY ALTO</small>
                        </div>
                    </a>
                    
                    <a href="https://www.boe.es/diario_boe/txt.php?id=BOE-2023-4688" target="_blank" class="alerta-link">
                        <div class="alerta-item critica">
                            <span class="alerta-tipo">üï∏Ô∏è CR√çTICA</span>
                            <div class="alerta-msg">RED EMPRESARIAL DETECTADA: GRUPO CONSTRUCCIONES MART√çNEZ</div>
                            <div class="alerta-motivo">3 empresas vinculadas ¬∑ 210.221.500‚Ç¨ total</div>
                            <small>M√öLTIPLES ¬∑ Impacto MUY ALTO</small>
                        </div>
                    </a>
                    
                    <a href="https://www.boe.es/diario_boe/txt.php?id=BOE-2025-7192" target="_blank" class="alerta-link">
                        <div class="alerta-item critica">
                            <span class="alerta-tipo">üï∏Ô∏è CR√çTICA</span>
                            <div class="alerta-msg">RED EMPRESARIAL DETECTADA: GRUPO TECNOL√ìGICO AVANZADO</div>
                            <div class="alerta-motivo">4 empresas vinculadas ¬∑ 202.798.032‚Ç¨ total</div>
                            <small>M√öLTIPLES ¬∑ Impacto MUY ALTO</small>
                        </div>
                    </a>
                    
                    <a href="https://www.boe.es/diario_boe/txt.php?id=BOE-2024-1698" target="_blank" class="alerta-link">
                        <div class="alerta-item critica">
                            <span class="alerta-tipo">üï∏Ô∏è CR√çTICA</span>
                            <div class="alerta-msg">RED EMPRESARIAL DETECTADA: GRUPO CONSULTOR√çA P√öBLICA</div>
                            <div class="alerta-motivo">4 empresas vinculadas ¬∑ 54.325.315‚Ç¨ total</div>
                            <small>M√öLTIPLES ¬∑ Impacto MUY ALTO</small>
                        </div>
                    </a>
                    
                </div>
            </div>
        </div>

        <div id="promesas" class="tab-content" style="display:none;">
            <div class="obs-card">
                <h2>üìä Promesas vs Realidad</h2>
                <canvas id="graficoPromesas" class="grafico-container"></canvas>
                
                <div style="margin:15px 0; padding:10px; background:var(--bg); border-radius:8px;">
                    <div style="display:flex; justify-content:space-between;">
                        <span>Aumentar gasto sanitario en 5% anual</span>
                        <span class="badge" style="background:green">100%</span>
                    </div>
                    <div class="progress"><div class="progress-bar" style="width:100%"></div></div>
                    <small>PSOE ¬∑ BOE</small>
                </div>
                
                <div style="margin:15px 0; padding:10px; background:var(--bg); border-radius:8px;">
                    <div style="display:flex; justify-content:space-between;">
                        <span>100.000 viviendas p√∫blicas</span>
                        <span class="badge" style="background:orange">12.0%</span>
                    </div>
                    <div class="progress"><div class="progress-bar" style="width:12.0%"></div></div>
                    <small>PP ¬∑ MITMA</small>
                </div>
                
            </div>
        </div>

        <div id="redes" class="tab-content" style="display:none;">
            <div class="obs-card">
                <h2>üï∏Ô∏è Redes Empresariales Detectadas</h2>
                
                <div style="margin:10px 0; padding:15px; background:#fee2e2; border-radius:8px;">
                    <span class="alerta-tipo">üï∏Ô∏è RED EMPRESARIAL DETECTADA: GRUPO CONSTRUCCIONES MART√çNEZ</span>
                    <p>3 empresas vinculadas ¬∑ 210.221.500‚Ç¨ total</p>
                </div>
                
                <div style="margin:10px 0; padding:15px; background:#fee2e2; border-radius:8px;">
                    <span class="alerta-tipo">üï∏Ô∏è RED EMPRESARIAL DETECTADA: GRUPO TECNOL√ìGICO AVANZADO</span>
                    <p>4 empresas vinculadas ¬∑ 202.798.032‚Ç¨ total</p>
                </div>
                
                <div style="margin:10px 0; padding:15px; background:#fee2e2; border-radius:8px;">
                    <span class="alerta-tipo">üï∏Ô∏è RED EMPRESARIAL DETECTADA: GRUPO CONSULTOR√çA P√öBLICA</span>
                    <p>4 empresas vinculadas ¬∑ 54.325.315‚Ç¨ total</p>
                </div>
                
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="dashboard.js"></script>
    <script>
        // Gr√°fico de promesas
        new Chart(document.getElementById('graficoPromesas'), {
            type: 'bar',
            data: {
                labels: ["Aumentar gasto sanit...", "100.000 viviendas p\u00fa..."],
                datasets: [{
                    label: '% Cumplimiento',
                    data: [100, 12.0],
                    backgroundColor: '#3b82f6'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: { y: { beginAtZero: true, max: 100 } }
            }
        });

        // Inicializar mapa
        var map = L.map('map').setView([40.4168, -3.7038], 6);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        
        fetch('datos/municipios.geojson')
            .then(r => r.json())
            .then(data => {
                L.geoJSON(data, {
                    style: (feature) => {
                        const riesgo = feature.properties.riesgo || 0;
                        let color = '#10b981';
                        if (riesgo >= 70) color = '#ef4444';
                        else if (riesgo >= 40) color = '#f59e0b';
                        else if (riesgo >= 20) color = '#eab308';
                        return {
                            fillColor: color,
                            fillOpacity: 0.7,
                            color: '#2563eb',
                            weight: feature.properties.tiene_alerta ? 3 : 1
                        };
                    }
                }).addTo(map);
            });
    </script>
</body>
</html>