<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Observatorio Anticorrupci√≥n</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="estilo.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .grafico-container {
            height: 200px;
            margin: 20px 0;
        }
        .leyenda-mapa {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            font-size: 0.8rem;
            margin: 10px 0;
        }
        .color-box {
            width: 15px;
            height: 15px;
            border-radius: 3px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="pull-indicator" id="pullIndicator">‚ü≥ Actualizar</div>
    
    <div class="container">
        <header class="obs-header">
            <h1>üïµÔ∏è Observatorio Anticorrupci√≥n</h1>
            <p>52 municipios ¬∑ 16 alertas ¬∑ 2,650,545,503‚Ç¨</p>
            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                <span class="badge">19/02/2026 12:49</span>
                <a href="datos/informe_transparencia.pdf" class="btn">üì• PDF</a>
                <button class="btn btn-outline" id="refreshBtn">üîÑ</button>
            </div>
        </header>

        <div class="tabs">
            <div class="tab active" onclick="showTab('mapa')">üó∫Ô∏è Mapa</div>
            <div class="tab" onclick="showTab('alertas')">üö® Alertas</div>
            <div class="tab" onclick="showTab('promesas')">üìä Promesas</div>
            <div class="tab" onclick="showTab('redes')">üï∏Ô∏è Redes</div>
        </div>

        <div id="mapa" class="tab-content">
            <div class="obs-card">
                <h2>üó∫Ô∏è Riesgo por Municipio</h2>
                <div id="map" style="height: 400px;"></div>
                <div class="leyenda-mapa">
                    <span><span class="color-box" style="background:#10b981;"></span> Bajo</span>
                    <span><span class="color-box" style="background:#eab308;"></span> Medio</span>
                    <span><span class="color-box" style="background:#f59e0b;"></span> Alto</span>
                    <span><span class="color-box" style="background:#ef4444;"></span> Muy alto</span>
                    <span>‚ö†Ô∏è Alerta activa</span>
                </div>
            </div>
        </div>

        <div id="alertas" class="tab-content" style="display:none;">
            <div class="obs-card">
                <h2>üö® Alertas Cr√≠ticas</h2>
                <div class="alertas-container">
                    
                    <a href="https://www.boe.es/diario_boe/txt.php?id=BOE-2023-6376" target="_blank" class="alerta-link">
                        <div class="alerta-item critica">
                            <span class="alerta-tipo">üî¥ CR√çTICA</span>
                            <div class="alerta-msg">SUBVENCI√ìN EXTREMA: Fundaci√≥n Madrid</div>
                            <div class="alerta-motivo">Importe de 79.111.464‚Ç¨ - 497% sobre la media</div>
                            <small>Madrid ¬∑ Impacto MUY ALTO</small>
                        </div>
                    </a>
                    
                    <a href="https://www.boe.es/diario_boe/txt.php?id=BOE-2026-6293" target="_blank" class="alerta-link">
                        <div class="alerta-item critica">
                            <span class="alerta-tipo">üî¥ CR√çTICA</span>
                            <div class="alerta-msg">SUBVENCI√ìN EXTREMA: Universidad de Araba/√Ålava</div>
                            <div class="alerta-motivo">Importe de 77.780.473‚Ç¨ - 487% sobre la media</div>
                            <small>Araba/√Ålava ¬∑ Impacto MUY ALTO</small>
                        </div>
                    </a>
                    
                    <a href="https://www.boe.es/diario_boe/txt.php?id=BOE-2025-4244" target="_blank" class="alerta-link">
                        <div class="alerta-item critica">
                            <span class="alerta-tipo">üî¥ CR√çTICA</span>
                            <div class="alerta-msg">SUBVENCI√ìN EXTREMA: Diputaci√≥n de Salamanca</div>
                            <div class="alerta-motivo">Importe de 76.806.599‚Ç¨ - 480% sobre la media</div>
                            <small>Salamanca ¬∑ Impacto MUY ALTO</small>
                        </div>
                    </a>
                    
                    <a href="https://www.boe.es/diario_boe/txt.php?id=BOE-2023-6064" target="_blank" class="alerta-link">
                        <div class="alerta-item critica">
                            <span class="alerta-tipo">üî¥ CR√çTICA</span>
                            <div class="alerta-msg">SUBVENCI√ìN EXTREMA: Diputaci√≥n de A Coru√±a</div>
                            <div class="alerta-motivo">Importe de 73.904.094‚Ç¨ - 458% sobre la media</div>
                            <small>A Coru√±a ¬∑ Impacto MUY ALTO</small>
                        </div>
                    </a>
                    
                    <a href="https://www.boe.es/diario_boe/txt.php?id=BOE-2026-7091" target="_blank" class="alerta-link">
                        <div class="alerta-item critica">
                            <span class="alerta-tipo">üî¥ CR√çTICA</span>
                            <div class="alerta-msg">SUBVENCI√ìN EXTREMA: Ayuntamiento de Granada</div>
                            <div class="alerta-motivo">Importe de 72.546.154‚Ç¨ - 447% sobre la media</div>
                            <small>Granada ¬∑ Impacto MUY ALTO</small>
                        </div>
                    </a>
                    
                    <a href="https://www.boe.es/diario_boe/txt.php?id=BOE-2023-5782" target="_blank" class="alerta-link">
                        <div class="alerta-item critica">
                            <span class="alerta-tipo">üî¥ CR√çTICA</span>
                            <div class="alerta-msg">SUBVENCI√ìN EXTREMA: Diputaci√≥n de Illes Balears</div>
                            <div class="alerta-motivo">Importe de 70.730.170‚Ç¨ - 434% sobre la media</div>
                            <small>Illes Balears ¬∑ Impacto MUY ALTO</small>
                        </div>
                    </a>
                    
                    <a href="https://www.boe.es/diario_boe/txt.php?id=BOE-2024-5472" target="_blank" class="alerta-link">
                        <div class="alerta-item critica">
                            <span class="alerta-tipo">üî¥ CR√çTICA</span>
                            <div class="alerta-msg">SUBVENCI√ìN EXTREMA: Universidad de Zaragoza</div>
                            <div class="alerta-motivo">Importe de 68.173.842‚Ç¨ - 414% sobre la media</div>
                            <small>Zaragoza ¬∑ Impacto MUY ALTO</small>
                        </div>
                    </a>
                    
                    <a href="https://www.boe.es/diario_boe/txt.php?id=BOE-2026-2039" target="_blank" class="alerta-link">
                        <div class="alerta-item critica">
                            <span class="alerta-tipo">üî¥ CR√çTICA</span>
                            <div class="alerta-msg">SUBVENCI√ìN EXTREMA: Gesti√≥n P√∫blica Avanzada SA</div>
                            <div class="alerta-motivo">Importe de 68.106.247‚Ç¨ - 414% sobre la media</div>
                            <small>Lleida ¬∑ Impacto MUY ALTO</small>
                        </div>
                    </a>
                    
                    <a href="https://www.boe.es/diario_boe/txt.php?id=BOE-2025-7114" target="_blank" class="alerta-link">
                        <div class="alerta-item critica">
                            <span class="alerta-tipo">üï∏Ô∏è CR√çTICA</span>
                            <div class="alerta-msg">RED EMPRESARIAL DETECTADA: GRUPO CONSULTOR√çA P√öBLICA</div>
                            <div class="alerta-motivo">4 empresas vinculadas ¬∑ 326.539.712‚Ç¨ total</div>
                            <small>M√öLTIPLES ¬∑ Impacto MUY ALTO</small>
                        </div>
                    </a>
                    
                    <a href="https://www.boe.es/diario_boe/txt.php?id=BOE-2023-6255" target="_blank" class="alerta-link">
                        <div class="alerta-item critica">
                            <span class="alerta-tipo">üï∏Ô∏è CR√çTICA</span>
                            <div class="alerta-msg">RED EMPRESARIAL DETECTADA: GRUPO CONSTRUCCIONES MART√çNEZ</div>
                            <div class="alerta-motivo">3 empresas vinculadas ¬∑ 94.697.036‚Ç¨ total</div>
                            <small>M√öLTIPLES ¬∑ Impacto MUY ALTO</small>
                        </div>
                    </a>
                    
                    <a href="https://www.boe.es/diario_boe/txt.php?id=BOE-2025-8535" target="_blank" class="alerta-link">
                        <div class="alerta-item critica">
                            <span class="alerta-tipo">üï∏Ô∏è CR√çTICA</span>
                            <div class="alerta-msg">RED EMPRESARIAL DETECTADA: GRUPO TECNOL√ìGICO AVANZADO</div>
                            <div class="alerta-motivo">3 empresas vinculadas ¬∑ 143.923.201‚Ç¨ total</div>
                            <small>M√öLTIPLES ¬∑ Impacto MUY ALTO</small>
                        </div>
                    </a>
                    
                </div>
            </div>
        </div>

        <div id="promesas" class="tab-content" style="display:none;">
            <div class="obs-card">
                <h2>üìä Promesas vs Realidad</h2>
                <canvas id="graficoPromesas" class="grafico-container"></canvas>
                
                <div style="margin:15px 0; padding:10px; background:var(--bg); border-radius:8px;">
                    <div style="display:flex; justify-content:space-between;">
                        <span>Aumentar el gasto sanitario en un 5% anual</span>
                        <span class="badge" style="background:green">100%</span>
                    </div>
                    <div class="progress"><div class="progress-bar" style="width:100%"></div></div>
                    <small>PSOE ¬∑ Ministerio de Sanidad</small>
                </div>
                
                <div style="margin:15px 0; padding:10px; background:var(--bg); border-radius:8px;">
                    <div style="display:flex; justify-content:space-between;">
                        <span>Construir 100.000 viviendas p√∫blicas</span>
                        <span class="badge" style="background:orange">12.0%</span>
                    </div>
                    <div class="progress"><div class="progress-bar" style="width:12.0%"></div></div>
                    <small>PP ¬∑ MITMA</small>
                </div>
                
                <div style="margin:15px 0; padding:10px; background:var(--bg); border-radius:8px;">
                    <div style="display:flex; justify-content:space-between;">
                        <span>Reducir listas de espera quir√∫rgicas a 60 d√≠as</span>
                        <span class="badge" style="background:green">100%</span>
                    </div>
                    <div class="progress"><div class="progress-bar" style="width:100%"></div></div>
                    <small>PSOE ¬∑ Ministerio de Sanidad</small>
                </div>
                
            </div>
        </div>

        <div id="redes" class="tab-content" style="display:none;">
            <div class="obs-card">
                <h2>üï∏Ô∏è Redes Empresariales Detectadas</h2>
                
                <div style="margin:10px 0; padding:15px; background:#fee2e2; border-radius:8px;">
                    <span class="alerta-tipo">üï∏Ô∏è RED EMPRESARIAL DETECTADA: GRUPO CONSULTOR√çA P√öBLICA</span>
                    <p>4 empresas vinculadas ¬∑ 326.539.712‚Ç¨ total</p>
                </div>
                
                <div style="margin:10px 0; padding:15px; background:#fee2e2; border-radius:8px;">
                    <span class="alerta-tipo">üï∏Ô∏è RED EMPRESARIAL DETECTADA: GRUPO CONSTRUCCIONES MART√çNEZ</span>
                    <p>3 empresas vinculadas ¬∑ 94.697.036‚Ç¨ total</p>
                </div>
                
                <div style="margin:10px 0; padding:15px; background:#fee2e2; border-radius:8px;">
                    <span class="alerta-tipo">üï∏Ô∏è RED EMPRESARIAL DETECTADA: GRUPO TECNOL√ìGICO AVANZADO</span>
                    <p>3 empresas vinculadas ¬∑ 143.923.201‚Ç¨ total</p>
                </div>
                
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="dashboard.js"></script>
    <script>
        // Gr√°fico de promesas
        new Chart(document.getElementById('graficoPromesas'), {
            type: 'bar',
            data: {
                labels: ["Aumentar el gasto sa...", "Construir 100.000 vi...", "Reducir listas de es...", "Aumentar becas FP en...", "Tipo impositivo PYME...", "Inversi\u00f3n I+D+i al 2..."],
                datasets: [{
                    label: '% Cumplimiento',
                    data: [100, 12.0, 100, 0.0, 0.0, 100],
                    backgroundColor: '#3b82f6'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: { y: { beginAtZero: true, max: 100 } }
            }
        });

        // Inicializar mapa
        var map = L.map('map').setView([40.4168, -3.7038], 6);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        
        fetch('datos/municipios.geojson')
            .then(r => r.json())
            .then(data => {
                L.geoJSON(data, {
                    style: (feature) => {
                        const riesgo = feature.properties.riesgo || 0;
                        let color = '#10b981';
                        if (riesgo >= 70) color = '#ef4444';
                        else if (riesgo >= 40) color = '#f59e0b';
                        else if (riesgo >= 20) color = '#eab308';
                        return {
                            fillColor: color,
                            fillOpacity: 0.7,
                            color: '#2563eb',
                            weight: feature.properties.tiene_alerta ? 3 : 1
                        };
                    }
                }).addTo(map);
            });
    </script>
</body>
</html>